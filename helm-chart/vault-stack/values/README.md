# Values Configuration Structure

This directory contains service-specific configuration files for the vault-stack Helm chart.

## Directory Structure

```
values/
├── global/
│   └── global.yaml          # Global settings (namespace, etc.)
├── vault/
│   └── vault.yaml           # Vault Enterprise configuration and secrets
├── elasticsearch/
│   └── elasticsearch.yaml   # ECK Operator and Elasticsearch secrets
├── grafana/
│   └── grafana.yaml         # Grafana configuration and secrets
├── prometheus/
│   └── prometheus.yaml      # Prometheus configuration
├── loki/
│   └── loki.yaml            # Loki configuration
└── promtail/
    └── promtail.yaml        # Promtail configuration
```

## Usage

The deployment script (`scripts/10_deploy_helm.sh`) automatically loads all values files in the correct order:

```bash
helm install vault-stack ./helm-chart/vault-stack \
  -f values/global/global.yaml \
  -f values/vault/vault.yaml \
  -f values/elasticsearch/elasticsearch.yaml \
  -f values/grafana/grafana.yaml \
  -f values/prometheus/prometheus.yaml \
  -f values/loki/loki.yaml \
  -f values/promtail/promtail.yaml
```

## Configuration Notes

- **Official Charts**: All services use official Helm charts from vendors:
  - Vault: HashiCorp official chart
  - Elasticsearch/Kibana: Elastic Cloud on Kubernetes (ECK) operator
  - Grafana, Loki, Promtail: Grafana official charts
  - Prometheus: Prometheus Community chart

- **Elasticsearch/Kibana Deployment**:
  - ECK operator is installed via Helm dependency
  - Elasticsearch and Kibana are deployed via ECK CRDs in `scripts/11_deploy_elk.sh`
  - This 2-step process ensures CRDs are available before deployment

- **Secrets Management**:
  - Vault license: Base64-encoded in `vault/vault.yaml`
  - Elasticsearch password: Auto-generated by ECK operator
  - Grafana credentials: Defined in `grafana/grafana.yaml`

## Modifying Configuration

To modify a service's configuration:

1. Edit the appropriate `values/<service>/<service>.yaml` file
2. Run `task up` to apply changes (or `helm upgrade` manually)
3. The deployment script will merge all values files automatically
