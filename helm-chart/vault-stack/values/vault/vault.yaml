# HashiCorp Vault Enterprise Configuration (official chart)
vault:
  enabled: true

  global:
    enabled: true
    namespace: vault-stack

  server:
    image:
      repository: "hashicorp/vault-enterprise"
      tag: "1.20-ent"
      pullPolicy: IfNotPresent

    enterpriseLicense:
      secretName: vault-license
      secretKey: license

    resources:
      requests:
        memory: 512Mi
        cpu: 250m
      limits:
        memory: 1Gi
        cpu: 500m

    dataStorage:
      enabled: true
      size: 10Gi

    auditStorage:
      enabled: false  # Disable built-in audit storage, use shared PVC instead

    # Shared audit logs volume for Elastic Agent access
    volumes:
      - name: vault-audit-logs
        persistentVolumeClaim:
          claimName: vault-audit-logs

    # Mount audit logs volume to shared location
    volumeMounts:
      - mountPath: /vault/logs
        name: vault-audit-logs

    # Extra volumes for HA mode (Helm chart uses different path for StatefulSets)
    extraVolumes:
      - type: pvc
        name: vault-audit-logs
        claimName: vault-audit-logs
        path: /vault/logs

    ha:
      enabled: true
      replicas: 1
      raft:
        enabled: true
        setNodeId: true
        config: |
          ui = true
          listener "tcp" {
            tls_disable = 1
            address = "[::]:8200"
            cluster_address = "[::]:8201"
          }
          storage "raft" {
            path = "/vault/data"
          }
          service_registration "kubernetes" {}
          telemetry {
            disable_hostname = true
            prometheus_retention_time = "12h"
            unauthenticated_metrics_access = true
          }

  ui:
    enabled: true

  injector:
    enabled: false

# Vault secrets configuration (base64 encoded)
# IMPORTANT: The licence must be provided via .env file
# The deployment script will read VAULT_LICENSE from .env and encode it
secrets:
  vault:
    license: ""  # Populated from .env file during deployment
    token: ""    # Placeholder - not used
